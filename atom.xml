<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-03-23T05:47:50.086Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>John Doe</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="http://yoursite.com/2018/03/23/Hello-World/"/>
    <id>http://yoursite.com/2018/03/23/Hello-World/</id>
    <published>2018-03-23T05:47:50.000Z</published>
    <updated>2018-03-23T05:47:50.086Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>交叉编译tor在路由器上使用</title>
    <link href="http://yoursite.com/2017/12/07/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91tor%E5%9C%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%8A%E4%BD%BF%E7%94%A8/"/>
    <id>http://yoursite.com/2017/12/07/交叉编译tor在路由器上使用/</id>
    <published>2017-12-07T15:23:00.000Z</published>
    <updated>2018-03-20T09:23:00.298Z</updated>
    
    <content type="html"><![CDATA[<p>Router Model : RT-AC66U<br>Router CPU : MIPS32</p><h2 id="正常编译tor"><a href="#正常编译tor" class="headerlink" title="正常编译tor"></a>正常编译tor</h2><p>在 <code>Ubuntu</code> 下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install openssl</span><br><span class="line">sudo apt-get install libevent-dev</span><br><span class="line">sudo apt-get install build-essential</span><br><span class="line">sudo apt-get install libssl-dev</span><br><span class="line">tar xzf tor-0.3.1.8.tar.gz</span><br><span class="line">cd tor-0.3.1.8</span><br><span class="line">./configure &amp;&amp; make</span><br><span class="line">src/or/tor</span><br><span class="line">src/config/torrc   # torrc </span><br><span class="line">src/or/tor -f src/config/torrc &amp;</span><br></pre></td></tr></table></figure><p>直接交叉编译tor 是有问题的<br>结合上篇文章编译buildroot生成的buildroot-2011.05下/output/ 相关编译文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd tor </span><br><span class="line">$ ./configure : </span><br><span class="line">$ CC=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc RANLIB=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ranlib AR=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ar LD=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ld STRIP=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-strip ./configure --host=mipsel-linux --disable-tool-name-check --enable-static-libevent --with-libevent-dir=/usr/local/lib</span><br></pre></td></tr></table></figure></p><a id="more"></a><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ CC=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc \</span><br><span class="line">RANLIB=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ranlib \</span><br><span class="line">AR=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ar \</span><br><span class="line">LD=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ld \</span><br><span class="line">STRIP=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-strip \</span><br><span class="line">./configure --host=mipsel-linux --disable-tool-name-check \</span><br><span class="line">--enable-static-libevent \</span><br><span class="line">--with-libevent-dir=/usr/local/lib</span><br><span class="line">or </span><br><span class="line">--with-libevent-dir=/usr/lib64/</span><br></pre></td></tr></table></figure></p><p>出错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">checking for libevent directory... configure: WARNING: Could not find a linkable libevent.</span><br><span class="line">If you have it installed somewhere unusual, you can specify an explicit path using --with-libevent-dir</span><br><span class="line">configure: WARNING: On most Redhat-based systems, you can get libevent by installing the libevent RPM package</span><br><span class="line">configure: WARNING:    You will probably need to install libevent-devel too.</span><br><span class="line">configure: error: Missing libraries; unable to proceed.</span><br></pre></td></tr></table></figure></p><p>装了libevent-devel 依旧如是</p><p>拷贝 bin/ 下的<code>mipsel-linux-*</code> 到 <code>ubuntu</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=/home/db/Desktop/usr/bin/mipsel-linux-gcc RANLIB=/home/db/Desktop/usr/bin/mipsel-linux-ranlib AR=/home/db/Desktop/usr/bin/mipsel-linux-ar LD=/home/db/Desktop/usr/bin/mipsel-linux-ld STRIP=/home/db/Desktop/usr/bin/mipsel-linux-strip ./configure --host=mipsel-linux --disable-tool-name-check --enable-static-libevent --with-libevent-dir=/home/db/Desktop/libevent-1.4.12-stable/</span><br></pre></td></tr></table></figure></p><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ CC=/home/db/Desktop/usr/bin/mipsel-linux-gcc \</span><br><span class="line">RANLIB=/home/db/Desktop/usr/bin/mipsel-linux-ranlib \</span><br><span class="line">AR=/home/db/Desktop/usr/bin/mipsel-linux-ar \</span><br><span class="line">LD=/home/db/Desktop/usr/bin/mipsel-linux-ld \</span><br><span class="line">STRIP=/home/db/Desktop/usr/bin/mipsel-linux-strip \</span><br><span class="line">./configure --host=mipsel-linux \</span><br><span class="line">--disable-tool-name-check --enable-static-libevent \</span><br><span class="line">--with-libevent-dir=/home/db/Desktop/libevent-1.4.12-stable/</span><br><span class="line">or </span><br><span class="line">--with-libevent-dir=/usr/lib/x86_64-linux-gnu/</span><br><span class="line">--with-libevent-dir=/lib/x86_64-linux-gnu/</span><br></pre></td></tr></table></figure></p><p>也是不行滴</p><p>ubuntu 直接编译 tor 后 拷贝<code>tor(10M)</code> 到 <code>centos</code>上使用,转移各种库依旧是不行滴。 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$./tor: error while loading shared libraries: libssl.so.1.0.0: cannot open shared object file: No such file or directory</span><br><span class="line">===&gt; </span><br><span class="line">$ copy /lib/x86_64-linux-gnu/libssl.so.1.0.0 (ubuntu)  =&gt; desktop (centos )</span><br><span class="line">$ copy /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (ubuntu)  =&gt; desktop (centos )</span><br><span class="line">$ mv libssl.so.1.0.0 /usr/lib64/(centos )</span><br><span class="line">$ mv libcrypto.so.1.0.0 /usr/lib64/(centos )</span><br></pre></td></tr></table></figure><p>$ ./tor –help<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">./tor: /lib64/libc.so.6: version &apos;GLIBC_2.14&apos; not found (required by ./tor)</span><br><span class="line">./tor: /lib64/libc.so.6: version &apos;GLIBC_2.17&apos; not found (required by ./tor)</span><br><span class="line">./tor: /lib64/libc.so.6: version &apos;GLIBC_2.14&apos; not found (required by /usr/lib64/libssl.so.1.0.0)</span><br><span class="line">./tor: /lib64/libc.so.6: version &apos;GLIBC_2.14&apos; not found (required by /usr/lib64/libcrypto.so.1.0.0)</span><br><span class="line">$ ls -al /lib/x86_64-linux-gnu/libc.so.6 (ubuntu)</span><br><span class="line">lrwxrwxrwx 1 root root 12 Jun 16 16:57 /lib/x86_64-linux-gnu/libc.so.6 -&gt; libc-2.23.so</span><br><span class="line">$ copy /lib/x86_64-linux-gnu/libc-2.23.so(ubuntu)  =&gt; desktop (centos )</span><br><span class="line">$ mv libc-2.23.so /lib64/libc-2.23.so (centos )</span><br><span class="line">ln: creating symbolic link &apos;/lib64/libc.so.6&apos;: File exists</span><br><span class="line">$ mv /lib64/libc.so.6 /lib64/libc.so.6-copy</span><br><span class="line">$ ln -s /lib64/libc-2.23.so /lib64/libc.so.6</span><br><span class="line">error error !!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span><br><span class="line">$ ls -al #命令都使用不了了</span><br><span class="line">ls: error while loading shared libraries: libc.so.6: cannot open shared object file: No such file or directory</span><br><span class="line">$ mv</span><br><span class="line">mv: error while loading shared libraries: libc.so.6: cannot open shared object file: No such file or directory</span><br></pre></td></tr></table></figure></p><p>看了网上,tor交叉编译时需要的库,也需要交叉编译的 : </p><p>Centos<br>/root/Desktop/1/ :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openssl-1.1.0g</span><br><span class="line">https://www.openssl.org/source/openssl-1.1.0g.tar.gz</span><br><span class="line"></span><br><span class="line">libevent-2.1.8-stable.tar.gz</span><br><span class="line">https://github.com/libevent/libevent/releases/download/release-2.1.8-stable/libevent-2.1.8-stable.tar.gz</span><br><span class="line"></span><br><span class="line">zlib-1.2.11</span><br><span class="line">https://zlib.net/zlib-1.2.11.tar.gz</span><br></pre></td></tr></table></figure></p><p><code>----------------------------------------------------------------------</code></p><h2 id="交叉编译-openssl"><a href="#交叉编译-openssl" class="headerlink" title="交叉编译 openssl"></a>交叉编译 openssl</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc AR=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ar RANLIB=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ranlib LD=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ld STRIP=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-strip ./config --prefix=/root/Desktop/cross/yes/openssl</span><br></pre></td></tr></table></figure><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ CC=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc \</span><br><span class="line">AR=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ar \</span><br><span class="line">RANLIB=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ranlib \</span><br><span class="line">./config \</span><br><span class="line">--prefix=/root/Desktop/cross/yes/openssl</span><br></pre></td></tr></table></figure></p><p>$ make 出错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">crypto/aes/aes-x86_64.s:1743: Error: unrecognized opcode &apos;leaq 48(%rsi),%rsp&apos;</span><br><span class="line">crypto/aes/aes-x86_64.s:1745: Error: unrecognized opcode &apos;popfq&apos;</span><br><span class="line">crypto/aes/aes-x86_64.s:1749: Error: Alignment too large: 28. assumed.</span><br><span class="line">crypto/aes/aes-x86_64.s:2139: Error: Alignment too large: 28. assumed.</span><br><span class="line">crypto/aes/aes-x86_64.s:2534: Error: Alignment too large: 28. assumed.</span><br><span class="line">make[1]: *** [crypto/aes/aes-x86_64.o] Error 1</span><br><span class="line">make[1]: Leaving directory &apos;/root/Desktop/cross/1/openssl-1.1.0g&apos;</span><br><span class="line">make: *** [all] Error 2</span><br></pre></td></tr></table></figure></p><p>使用 <code>--cross-compile-prefix</code> :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=gcc RANLIB=ranlib AR=ar ./config --prefix=/root/Desktop/cross/yes/openssl/ --cross-compile-prefix=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux- linux-mips32</span><br></pre></td></tr></table></figure></p><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ CC=gcc \</span><br><span class="line">RANLIB=ranlib \</span><br><span class="line">AR=ar \</span><br><span class="line">./config \</span><br><span class="line">--prefix=/root/Desktop/cross/yes/openssl/ \</span><br><span class="line">--cross-compile-prefix=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux- \</span><br><span class="line">linux-mips32</span><br></pre></td></tr></table></figure></p><p>编译成功是因为<code>Makefile</code>根本没起作用,上面那些参数根本没填入到Makefile里面</p><p><code>https://github.com/openssl/openssl/blob/master/INSTALL</code><br>官方文档说使用<code>--cross-compile-prefix</code>时,必须用<code>./Configure</code>,而不是./config<br>==&gt;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=gcc RANLIB=ranlib AR=ar ./Configure --prefix=/root/Desktop/cross/yes/openssl/ --cross-compile-prefix=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux- linux-mips32</span><br></pre></td></tr></table></figure></p><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ CC=gcc \</span><br><span class="line">RANLIB=ranlib \</span><br><span class="line">AR=ar \</span><br><span class="line">./Configure \####./config 改成 ./Configure</span><br><span class="line">--prefix=/root/Desktop/cross/yes/openssl/ \</span><br><span class="line">--cross-compile-prefix=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux- \</span><br><span class="line">linux-mips32</span><br><span class="line">or os/compiler:linux-mips32</span><br></pre></td></tr></table></figure></p><p>$ make 出错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/root/Desktop/8/buildroot-2011.05/output/host/usr/mipsel-unknown-linux-uclibc/sysroot/usr/include/features.h:216:5: \</span><br><span class="line">error: #error It appears you have defined _FILE_OFFSET_BITS=64. Unfortunately, uClibc was built without large file support enabled.</span><br><span class="line">In file included from /root/Desktop/8/buildroot-2011.05/output/host/usr/mipsel-unknown-linux-uclibc/sysroot/usr/include/stdio.h:72,</span><br><span class="line"> from crypto/bio/bss_file.c:37:</span><br><span class="line">/root/Desktop/8/buildroot-2011.05/output/host/usr/mipsel-unknown-linux-uclibc/sysroot/usr/include/bits/uClibc_stdio.h:61:2: \</span><br><span class="line">error: #error Sorry... uClibc was built without large file support!</span><br></pre></td></tr></table></figure></p><p>发现 ===&gt; <code>https://bjglife.blogspot.nl/2015/01/linux-porting-openssl-to-mips-platform.html</code><br>===&gt; 文章里面选择了这个 <code>Enable large file (files &gt; 2 GB) support</code> 想必和错误有关</p><p>之前编译buildroot:<br>    choose:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Target Architecture (MIPS (little endian))  ---&gt;</span><br><span class="line">Target Architecture Variant (mips 32)  ---&gt;</span><br></pre></td></tr></table></figure></p><p>生成 =&gt; /root/Desktop/8/buildroot-2011.05/output/host/usr/bin<br>现在编译buildroot:<br>    choose:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Target Architecture (MIPS (little endian))  ---&gt;</span><br><span class="line">Target Architecture Variant (mips 32)  ---&gt;</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable large file (files &gt; 2 GB) support</span><br></pre></td></tr></table></figure></p><p>生成 =&gt; /root/Desktop/88/buildroot-2011.05/output/host/usr/bin </p><p>变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export MIPSEL_LINUX_PATH=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin    ##### unset MIPSEL_LINUX_PATH</span><br><span class="line">$ export MIPSEL_LINUX_PATH2=/root/Desktop/88/buildroot-2011.05/output/host/usr/bin    ##### unset MIPSEL_LINUX_PATH2</span><br></pre></td></tr></table></figure></p><p>再次交叉编译 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./Configure no-async --prefix=/root/Desktop/cross/yes/openssl2 --cross-compile-prefix=$MIPSEL_LINUX_PATH2/mipsel-linux- linux-mips32</span><br></pre></td></tr></table></figure></p><p>找错 <code>https://github.com/openssl/openssl/issues/1607</code>  ==&gt; add <code>no-async</code>  # 不加否则错误<br>$ make<br>$ make install<br>ok =&gt; /root/Desktop/cross/yes/openssl2</p><p>到openssl2下面执行/root/Desktop/cross/yes/openssl2/lib<br>$ file libssl.so.1.1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libssl.so.1.1: ELF 32-bit LSB shared object, MIPS, MIPS32 version 1 (SYSV), dynamically linked, with unknown capability 0xf41 = 0x756e6700, with unknown capability 0x70100 = 0x3040000, not stripped</span><br></pre></td></tr></table></figure></p><p>ok编译成功</p><p>对了 这边需要很强调一点是 编译哪个版本的buildroot,即使编译buildroot时多选了几个选项,都需要根据Buildroot编译后的bin/下面的文件，进行对<code>openssl</code>再次交叉编译，不然出现 <code>You will probably need to install openssl-devel too.</code></p><hr><h2 id="交叉编译-libevent"><a href="#交叉编译-libevent" class="headerlink" title="交叉编译 libevent"></a>交叉编译 libevent</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --prefix=/root/Desktop/cross/yes/libevent CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip --host=mipsel-linux</span><br></pre></td></tr></table></figure><p>错误<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bufferevent_openssl.c:66:10: fatal error: &apos;openssl/bio.h&apos; file not found</span><br></pre></td></tr></table></figure></p><p>找错 <code>https://github.com/libevent/libevent/issues/465</code><br>需要配合 <code>openssl</code> 加上 <code>CPPFLAGS</code> and <code>LDFLAGS</code></p><p>再次交叉编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --prefix=/root/Desktop/cross/yes/libevent CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip --host=mipsel-linux CPPFLAGS=-I/root/Desktop/cross/yes/openssl2/include LDFLAGS=-L/root/Desktop/cross/yes/openssl2/lib</span><br></pre></td></tr></table></figure></p><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --prefix=/root/Desktop/cross/yes/libevent \</span><br><span class="line">CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc \</span><br><span class="line">AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar \</span><br><span class="line">RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib \</span><br><span class="line">LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld \</span><br><span class="line">STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip \</span><br><span class="line">--host=mipsel-linux \</span><br><span class="line">CPPFLAGS=-I/root/Desktop/cross/yes/openssl2/include \</span><br><span class="line">LDFLAGS=-L/root/Desktop/cross/yes/openssl2/lib</span><br></pre></td></tr></table></figure></p><p>警告<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/root/Desktop/cross/yes/openssl2/lib/libcrypto.so: warning: gethostbyname is obsolescent, use getnameinfo() instead.</span><br></pre></td></tr></table></figure></p><p>$ make<br>$ make install<br>ok=&gt; /root/Desktop/cross/yes/openssl2</p><p>到libevent下面执行/root/Desktop/cross/yes/libevent/lib<br>$ file libevent-2.1.so.6.0.2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libevent-2.1.so.6.0.2: ELF 32-bit LSB shared object, MIPS, MIPS32 version 1 (SYSV), dynamically linked, with unknown capability 0xf41 = 0x756e6700, with unknown capability 0x70100 = 0x3040000, not stripped</span><br></pre></td></tr></table></figure></p><p><code>编译成功</code></p><h2 id="交叉编译-zlib"><a href="#交叉编译-zlib" class="headerlink" title="交叉编译 zlib"></a>交叉编译 zlib</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --prefix=/root/Desktop/cross/yes/zlib</span><br><span class="line">$ CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib</span><br></pre></td></tr></table></figure><p>$ make install<br>到zlib目录/root/Desktop/cross/yes/zlib/lib里面执行<br>$ file libz.so.1.2.11<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libz.so.1.2.11: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, not stripped</span><br></pre></td></tr></table></figure></p><p>这根本不是mips属性的,编译错了zlib<br>如果交叉编译成功的话,属性应该是有<code>MIPS32 version</code>。</p><p>重新交叉编译 zlib<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib ./configure --prefix=/root/Desktop/cross/yes/zlib</span><br></pre></td></tr></table></figure></p><p>$ make<br>$ make install<br>到zlib目录里面执行/root/Desktop/cross/yes/zlib/lib<br>$ file libz.so.1.2.11<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libz.so.1.2.11: ELF 32-bit LSB shared object, MIPS, MIPS32 version 1 (SYSV), dynamically linked, with unknown capability 0xf41 = 0x756e6700, with unknown capability 0x70100 = 0x3040000, not stripped</span><br></pre></td></tr></table></figure></p><p>编译成功</p><hr><h2 id="交叉编译-tor"><a href="#交叉编译-tor" class="headerlink" title="交叉编译 tor"></a>交叉编译 tor</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip ./configure --host=mipsel-linux --disable-tool-name-check --prefix=/root/Desktop/cross/yes/tor --enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent --enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 --enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib</span><br></pre></td></tr></table></figure><p><code>or</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$  ./configure --host=mipsel-linux --disable-tool-name-check --prefix=/root/Desktop/cross/yes/tor CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip --enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent --enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 --enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib</span><br></pre></td></tr></table></figure></p><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ CC=$MIPSEL_LINUX_PATH2/mipsel-linux-gcc \</span><br><span class="line">AR=$MIPSEL_LINUX_PATH2/mipsel-linux-ar \</span><br><span class="line">RANLIB=$MIPSEL_LINUX_PATH2/mipsel-linux-ranlib \</span><br><span class="line">LD=$MIPSEL_LINUX_PATH2/mipsel-linux-ld \</span><br><span class="line">STRIP=$MIPSEL_LINUX_PATH2/mipsel-linux-strip \</span><br><span class="line">./configure --host=mipsel-linux --disable-tool-name-check --prefix=/root/Desktop/cross/yes/tor \</span><br><span class="line">--enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent \</span><br><span class="line">--enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 \</span><br><span class="line">--enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib \</span><br></pre></td></tr></table></figure></p><p>错误 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">checking for mipsel-linux-gcc... /mipsel-linux-gcc</span><br><span class="line">checking whether the C compiler works... no</span><br><span class="line">configure: error: in `/root/Desktop/9/tor-0.3.1.8&apos;:</span><br><span class="line">configure: error: C compiler cannot create executables</span><br><span class="line">See &apos;config.log&apos; for more details</span><br></pre></td></tr></table></figure></p><p>检查config.log :<br>发现:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">configure:3752: checking for C compiler version</span><br><span class="line">configure:3761: /mipsel-linux-gcc --version &gt;&amp;5</span><br><span class="line">./configure: line 3763: /mipsel-linux-gcc: No such file or directory</span><br><span class="line">configure:3772: $? = 127</span><br></pre></td></tr></table></figure></p><p>???? $MIPSEL_LINUX_PATH2 根本就没识别,<br>export 查看所有变量 发现???根本没有$MIPSEL_LINUX_PATH2。 我不是刚才编译zlib的时候才用了吗?<br>再次设置变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export MIPSEL_LINUX_PATH2=/root/Desktop/88/buildroot-2011.05/output/host/usr/bin</span><br></pre></td></tr></table></figure></p><p>重新交叉编译tor<br>没错误<br>$ make 后错误:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">configure: WARNING: Unable to find liblzma.</span><br><span class="line">checking for ZSTD... no</span><br><span class="line">configure: WARNING: Unable to find libzstd</span><br><span class="line">src/ext/keccak-tiny/keccak-tiny-unrolled.c: In function &apos;xorin8&apos;:</span><br><span class="line">src/ext/keccak-tiny/keccak-tiny-unrolled.c:105: error: &apos;for&apos; loop initial declaration used outside C99 mode</span><br></pre></td></tr></table></figure></p><p>查看config.log 发现:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">checking for /root/Desktop/88/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc option to accept ISO C89... (cached) none needed</span><br><span class="line">checking for /root/Desktop/88/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc option to accept ISO C99... unsupported</span><br></pre></td></tr></table></figure></p><p>gcc版本太低了? 不支持?难道又要重新编译buildroot?</p><p>重新编译buildroot 加上一些选项:<br>choose:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Target Architecture (MIPS (little endian) or MIPSEL)  ---&gt;</span><br><span class="line">Target Architecture Variant (mips 32)  ---&gt;</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Build/install a shared libgcc?default)</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable MMU support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Use software floatinf point by default </span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable large file (files &gt; 2 GB) support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; -*- Enable WCHAR support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable toolchain locale/i18n support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable &apos;program invocation name&apos; support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable C++ support</span><br><span class="line">Toolchain type (Buildroot toolchain)  ---&gt; [*] Enable stack protection support</span><br><span class="line">GCC compiler Version --&gt; gcc 4.6.x</span><br></pre></td></tr></table></figure></p><p><strong>buildroot choose</strong><br>2011-05-toolchain_choose.png</p><p>设置变量 :<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ export MIPSEL_LINUX_PATH3=/root/Desktop/888/buildroot-2011.05/output/host/usr/bin</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --host=mipsel-linux --disable-tool-name-check --prefix=/root/Desktop/cross/yes/tor CC=&quot;$MIPSEL_LINUX_PATH3/mipsel-linux-gcc -std=gnu99&quot; AR=$MIPSEL_LINUX_PATH3/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH3/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH3/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH3/mipsel-linux-strip --enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent --enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 --enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib --disable-gcc-hardening</span><br></pre></td></tr></table></figure><p>即:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">./configure --host=mipsel-linux --disable-tool-name-check \</span><br><span class="line">--prefix=/root/Desktop/cross/yes/tor \</span><br><span class="line">CC=&quot;$MIPSEL_LINUX_PATH3/mipsel-linux-gcc -std=gnu99&quot; \</span><br><span class="line">AR=$MIPSEL_LINUX_PATH3/mipsel-linux-ar \</span><br><span class="line">RANLIB=$MIPSEL_LINUX_PATH3/mipsel-linux-ranlib \</span><br><span class="line">LD=$MIPSEL_LINUX_PATH3/mipsel-linux-ld \</span><br><span class="line">STRIP=$MIPSEL_LINUX_PATH3/mipsel-linux-strip \</span><br><span class="line">--enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent \</span><br><span class="line">--enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 \</span><br><span class="line">--enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib \</span><br><span class="line">--disable-gcc-hardening</span><br></pre></td></tr></table></figure></p><p>$ make 后报错:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">src/common/compress_lzma.c:22:18: fatal error: lzma.h: No such file or directory</span><br><span class="line">compilation terminated.</span><br><span class="line">make[1]: *** [src/common/compress_lzma.o] Error 1</span><br></pre></td></tr></table></figure></p><p>难道版本问题吗?<br><code>tor-0.2.5.15</code> 版本<br><code>https://dist.torproject.org/tor-0.2.5.15.tar.gz</code><br>make 后错误:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">src/common/aes.c:156:20: error: field &apos;evp&apos; has incomplete type</span><br><span class="line">src/common/aes.c: In function &apos;evaluate_ctr_for_aes&apos;:</span><br><span class="line">src/common/aes.c:259:5: warning: implicit declaration of function &apos;AES_ctr128_encrypt&apos; [-Wimplicit-function-declaration]</span><br><span class="line">make[1]: *** [src/common/aes.o] Error 1</span><br></pre></td></tr></table></figure></p><p>这不是以前遇到的错误,不是缺少什么需要交叉编译的库,而是 每个版本不同导致错误也不同…….</p><p><code>tor-0.2.9.13</code> 版本<br><code>https://dist.torproject.org/tor-0.2.9.13.tar.gz</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --host=mipsel-linux --disable-tool-name-check --prefix=/root/Desktop/cross/yes/tor CC=&quot;$MIPSEL_LINUX_PATH3/mipsel-linux-gcc -std=gnu99&quot; AR=$MIPSEL_LINUX_PATH3/mipsel-linux-ar RANLIB=$MIPSEL_LINUX_PATH3/mipsel-linux-ranlib LD=$MIPSEL_LINUX_PATH3/mipsel-linux-ld STRIP=$MIPSEL_LINUX_PATH3/mipsel-linux-strip --enable-static-libevent --with-libevent-dir=/root/Desktop/cross/yes/libevent2 --enable-static-openssl --with-openssl-dir=/root/Desktop/cross/yes/openssl2 --enable-static-zlib --with-zlib-dir=/root/Desktop/cross/yes/zlib2 --disable-gcc-hardening</span><br></pre></td></tr></table></figure></p><p><strong>./configure</strong><br>configure_tor.png</p><p>make 报警告<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/root/Desktop/9/ttor-0.2.9.13/src/common/compat.c:864: warning: the use of OBSOLESCENT &apos;utime&apos; is discouraged, use `utimes&apos;</span><br><span class="line">/root/Desktop/cross/yes/openssl2/lib/libcrypto.a(b_sock.o): In function &apos;BIO_gethostbyname&apos;:b_sock.c:(.text+0x80): warning: gethostbyname is obsolescent, use getnameinfo() instead.</span><br></pre></td></tr></table></figure></p><p>make install<br>但是！！！！！！！！！！！！！！！！<br>交叉编译成功了<br>$ file tor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tor: ELF 32-bit LSB executable, MIPS, MIPS32 version 1 (SYSV), dynamically linked (uses shared libs), with unknown capability 0xf41 = 0x756e6700, with unknown capability 0x70100 = 0x3040000, not stripped</span><br></pre></td></tr></table></figure></p><p><strong>tor</strong><br>file_tor.png</p><p>tor <code>9468 kb</code><br>压缩传到http网盘上去 tor.zip <code>3730 kb</code></p><p><code>http://www98.zippyshare.com/d/tHqb09lT/39660/tor.zip</code><br><code>http://www54.zippyshare.com/d/59vM7raQ/19523/tor.tar.gz</code></p><p>路由器上运行<code>tor</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">admin@RT-AC66U: unzip tor.zip </span><br><span class="line">=&gt; unzip: invalid zip magic 4F44213C</span><br><span class="line">admin@RT-AC66U:/tmp/home/root# tar zxvf tor.tar.gz</span><br><span class="line">=&gt; tar: invalid gzip magic</span><br></pre></td></tr></table></figure></p><p>开个远程机器吧,然后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /tmp </span><br><span class="line">python -m SimpleHTTPServer </span><br><span class="line">mv tor /tmp</span><br><span class="line">wget http://ip/tor 即可.</span><br></pre></td></tr></table></figure></p><p><strong>running tor</strong><br>router_tor.png</p><p>之前我怀疑传到路由器上的tor运行时需要某些库文件的,运行发现是不需要的</p><p>但是还是有segmentation fault。<br>还是要用QEMU模拟MIPS测试….</p><p>0x06 qemu模拟mips运行tor</p><p>转到Ubuntu的<br>拷贝buildroot编译成的rootfs.tar（buildroot-2011.05 /output/ images）<br>里面有个lib文件夹，将里面的链接库sudo mv * /lib/</p><p>之后直接运行TOR（qemu的安装后会自动识别MIPS类型的文件）<br>在Ubuntu中运行qemu<br>running_tor_in_ubuntu.png</p><p>QEMU模拟MIPS运行TOR完美运行成功！</p><p>问题来了为什么在路由器上运行失败segmentation fault呢？</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Router Model : RT-AC66U&lt;br&gt;Router CPU : MIPS32&lt;/p&gt;
&lt;h2 id=&quot;正常编译tor&quot;&gt;&lt;a href=&quot;#正常编译tor&quot; class=&quot;headerlink&quot; title=&quot;正常编译tor&quot;&gt;&lt;/a&gt;正常编译tor&lt;/h2&gt;&lt;p&gt;在 &lt;code&gt;Ubuntu&lt;/code&gt; 下&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install openssl&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install libevent-dev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install build-essential&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;sudo apt-get install libssl-dev&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tar xzf tor-0.3.1.8.tar.gz&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cd tor-0.3.1.8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;./configure &amp;amp;&amp;amp; make&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;src/or/tor&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;src/config/torrc   # torrc &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;src/or/tor -f src/config/torrc &amp;amp;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;直接交叉编译tor 是有问题的&lt;br&gt;结合上篇文章编译buildroot生成的buildroot-2011.05下/output/ 相关编译文件:&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;$ cd tor &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ ./configure : &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$ CC=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-gcc RANLIB=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ranlib AR=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ar LD=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-ld STRIP=/root/Desktop/8/buildroot-2011.05/output/host/usr/bin/mipsel-linux-strip ./configure --host=mipsel-linux --disable-tool-name-check --enable-static-libevent --with-libevent-dir=/usr/local/lib&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="交叉编译" scheme="http://yoursite.com/tags/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"/>
    
      <category term="路由器" scheme="http://yoursite.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
      <category term="tor" scheme="http://yoursite.com/tags/tor/"/>
    
  </entry>
  
  <entry>
    <title>交叉编译netcat在路由器上使用 - 从入门到放弃再到success</title>
    <link href="http://yoursite.com/2017/11/27/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91netcat%E5%9C%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E4%B8%8A%E4%BD%BF%E7%94%A8%20-%20%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83%E5%86%8D%E5%88%B0success/"/>
    <id>http://yoursite.com/2017/11/27/交叉编译netcat在路由器上使用 - 从入门到放弃再到success/</id>
    <published>2017-11-28T03:25:51.000Z</published>
    <updated>2018-03-20T09:23:00.298Z</updated>
    
    <content type="html"><![CDATA[<p>Author : <a href="https://sp4rr0w.github.io" target="_blank" rel="noopener">https://sp4rr0w.github.io</a><br>Time : 2017-11-27 22:25:51<br>Router Model : RT-N12<br>Router CPU : MIPS32</p><h2 id="1-路由器架构"><a href="#1-路由器架构" class="headerlink" title="1. 路由器架构"></a>1. 路由器架构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">admin@RT-N12:/tmp/home/root</span><br><span class="line">cat /proc/cpuinfo</span><br><span class="line">system type             : Broadcom BCM53572 chip rev 1 pkg 8</span><br><span class="line">processor               : 0</span><br><span class="line">cpu model               : MIPS 74K V4.9</span><br><span class="line">BogoMIPS                : 149.91</span><br><span class="line">wait instruction        : no</span><br><span class="line">microsecond timers      : yes</span><br><span class="line">tlb_entries             : 32</span><br><span class="line">extra interrupt vector  : no</span><br><span class="line">hardware watchpoint     : yes</span><br><span class="line">ASEs implemented        : mips16 dsp</span><br><span class="line">shadow register sets    : 1</span><br><span class="line">VCED exceptions         : not available</span><br><span class="line">VCEI exceptions         : not available</span><br><span class="line"></span><br><span class="line">unaligned_instructions  : 51078121</span><br><span class="line">dcache hits             : 2147483648</span><br><span class="line">dcache misses           : 0</span><br><span class="line">icache hits             : 2147483648</span><br><span class="line">icache misses           : 0</span><br><span class="line">instructions            : 2147483648</span><br></pre></td></tr></table></figure><h2 id="2-先编译buildroot"><a href="#2-先编译buildroot" class="headerlink" title="2. 先编译buildroot"></a>2. 先编译buildroot</h2><p>可知<code>路由器CPU</code>为 <code>MIPS</code>。由同事告知可以先编译<code>buildroot</code>生成的gcc之后再指定编译<code>netcat</code>，这样可以在路由器上运行。</p><p><code>折腾</code>之路由此开始</p><p>下载buildroot</p><ul><li><a href="https://buildroot.org/downloads/buildroot-2017.08.tar.gz" target="_blank" rel="noopener">https://buildroot.org/downloads/buildroot-2017.08.tar.gz</a></li></ul><a id="more"></a><p>后编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make menuconfig</span><br></pre></td></tr></table></figure></p><p>出现<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;make menuconfig&apos; requires the ncurses libraries</span><br></pre></td></tr></table></figure></p><p>Centos 下需要安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ncurses-devel -y</span><br></pre></td></tr></table></figure></p><p>若出现这个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Your Perl installation is not complete enough; at least the following</span><br><span class="line">modules are missing:</span><br><span class="line">         Data::Dumper</span><br><span class="line">         ExtUtils::MakeMaker</span><br><span class="line">         Thread::Queue</span><br></pre></td></tr></table></figure></p><p>解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install &apos;perl(Data::Dumper)&apos; -y </span><br><span class="line">yum install &apos;perl(ExtUtils::MakeMaker)&apos; -y </span><br><span class="line">yum install &apos;perl(Thread::Queue)&apos; -y</span><br></pre></td></tr></table></figure></p><p>运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd buildroot-2017.08</span><br><span class="line">make manuconfig</span><br></pre></td></tr></table></figure></p><p><strong>Buildroot Configuration</strong><br>Buildroot_Configuration.png</p><p><strong>选择 Target options</strong><br>Target_options.png<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Target Architecture---&gt; `MIPS (little endian)` </span><br><span class="line">Target Architecture Variant---&gt; `Generic MIPS32 ` </span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><p>make 三十分钟之后ok.<br>猜测<code>MIPS (little endian)</code> ，因为尝试编译了很多次才发现的，血泪教训。而路由器使用<code>MIPS</code>编译buildroot的时候会有很多选择，各自生成的gcc也不同。如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mips64 big endian       mips64 little endian</span><br><span class="line">mips64-linux-gcc        mips64el-linux-gcc</span><br><span class="line"></span><br><span class="line">mips big endian         mips little endian    </span><br><span class="line">mips-linux-gcc          mipsel-linux-gcc</span><br></pre></td></tr></table></figure><p>选择mips32 little endian 即会生成mipsel-linux-gcc。</p><p><strong>Toolchian 选择3.2 (里面最低内核版本)</strong><br>Toolchain.png<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Kernel Headers---&gt; `Linux 3.2.x kernel headers`  </span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><p>开始编译<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure></p><p>编译完成结尾显示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.....</span><br><span class="line">/usr/bin/install -m 0644 support/misc/target-dir-warning.txt /root/Desktop/6_mipsel_little/buildroot-2017.08/output/target/THIS_IS_NOT_YOUR_ROOT_FILESYSTEM</span><br></pre></td></tr></table></figure></p><p>编译之后生成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">./buildroot-2017.08/output/host/bin/    ：</span><br><span class="line">    mipsel-linux-gcc</span><br><span class="line">    mipsel-linux-ranlib </span><br><span class="line">    mipsel-linux-ar</span><br><span class="line">    mipsel-linux-ld </span><br><span class="line">    mipsel-linux-strip </span><br><span class="line">and</span><br><span class="line">./buildroot-2017.08/output/host/mipsel-buildroot-linux-uclibc/sysroot/lib/  ：</span><br><span class="line">    ld-uClibc.so.0 -&gt; ld-uClibc.so.1</span><br><span class="line">    ld-uClibc.so.1 -&gt; ld-uClibc-1.0.26.so</span><br><span class="line">    ld-uClibc-1.0.26.so</span><br><span class="line"></span><br><span class="line">    libc.so.0 -&gt; libuClibc-1.0.26.so</span><br><span class="line">    libc.so.1 -&gt; libuClibc-1.0.26.so</span><br><span class="line">    libuClibc-1.0.26.so</span><br></pre></td></tr></table></figure></p><h2 id="3-编译netcat"><a href="#3-编译netcat" class="headerlink" title="3. 编译netcat"></a>3. 编译netcat</h2><p>下载netcat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://sourceforge.net/projects/netcat/files/netcat/0.7.1/netcat-0.7.1.tar.gz/download -O netcat-0.7.1.tar.gz</span><br></pre></td></tr></table></figure></p><p>编译netcat<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd netcat-0.7.1</span><br><span class="line">./configure</span><br><span class="line">make CC=/root/Desktop/buildroot-2017.08/output/host/bin/mips64el-linux-gcc</span><br></pre></td></tr></table></figure></p><p>不行的话就全部指定<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd netcat-0.7.1 </span><br><span class="line">CC=/root/Desktop/6_mipsel_little/buildroot-2017.08/output/host/bin/mipsel-linux-gcc RANLIB=/root/Desktop/6_mipsel_little/buildroot-2017.08/output/host/bin/mipsel-linux-ranlib AR=/root/Desktop/6_mipsel_little/buildroot-2017.08/output/host/bin/mipsel-linux-ar LD=/root/Desktop/6_mipsel_little/buildroot-2017.08/output/host/bin/mipsel-linux-ld STRIP=/root/Desktop/6_mipsel_little/buildroot-2017.08/output/host/bin/mipsel-linux-strip ./configure --host=mipsel-linux</span><br><span class="line">make</span><br></pre></td></tr></table></figure></p><p>编译之后生成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd src </span><br><span class="line">file ./netcat </span><br><span class="line">    ./netcat: ELF 32-bit LSB executable, MIPS, N32 `MIPS64` version 1 (SYSV), dynamically linked (uses shared libs), with unknown capability 0xf41 = 0x756e6700, with unknown capability 0x70100 = 0x3040000, not stripped</span><br><span class="line">./netcat </span><br><span class="line">    bash: ./netcat: cannot execute binary file</span><br></pre></td></tr></table></figure></p><p><code>telnet</code>登录路由器，使用wget 下载我的netcat（不可以传到<code>https的网络盘</code>，因为路由上的wget不支持https。例如<code>https://dropfile.to</code>或者其他，一定传http类型网站例如<code>http://s.dropcanvas.com</code>）</p><p>之后发现<code>./netcat</code> 可以运行，但是 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">admin@RT-N12:/tmp/home/root# ./netcat</span><br><span class="line">Cmd Line : -lvvp 5555</span><br><span class="line">segmentation fault</span><br><span class="line"></span><br><span class="line">admin@RT-N12:/tmp/home/root# ./netcat_mips_little -h</span><br><span class="line">GNU netcat 0.7.1, a rewrite of the famous networking tool.</span><br><span class="line">Basic usages:</span><br><span class="line">connect to somewhere:  ./netcat_mips_little [options] hostname port [port] ...</span><br><span class="line">listen for inbound:    ./netcat_mips_little -l -p port [options] [hostname] [port] ...</span><br><span class="line"></span><br><span class="line">admin@RT-N12:/tmp/home/root# ./netcat_mips_little 192.168.19.113 5555 &lt; 1.txt</span><br><span class="line">segmentation fault</span><br></pre></td></tr></table></figure></p><p>只有-h参数可用（心中万只草泥马飞奔而过）,不然都是<code>segmentation fault</code></p><p>无法知道错误，大神又告诉我，<code>Qemu</code>可以模拟MIPS运行netcat</p><h2 id="转到Ubuntu"><a href="#转到Ubuntu" class="headerlink" title="转到Ubuntu"></a>转到Ubuntu</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qemu</span><br><span class="line">    ==&gt;</span><br><span class="line">        /usr/bin/qemu-system-i386</span><br><span class="line">        /usr/bin/qemu-mipsel</span><br><span class="line">        /usr/bin/qemu*</span><br></pre></td></tr></table></figure><p>出错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/qemu-mipsel netcat_mipsel_little</span><br><span class="line">    =&gt;  /lib/ld-uClibc.so.0: No such file or directory</span><br></pre></td></tr></table></figure></p><p>解决（<code>ld-uClibc-1.0.26.so</code>在上面已经提到了 在<code>./buildroot-2017.08/output/host/mipsel-buildroot-linux-uclibc/sysroot/lib/</code>里）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mv ld-uClibc-1.0.26.so /lib/</span><br><span class="line">sudo chown -R root:root /lib/ld-uClibc-1.0.26.so</span><br><span class="line">sudo ln -s /lib/ld-uClibc-1.0.26.so /lib/ld-uClibc.so.0</span><br></pre></td></tr></table></figure></p><p>出错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/qemu-mipsel netcat_mipsel_little</span><br><span class="line">    =&gt;  /home/db/Desktop/netcat_mipsel_little: can&apos;t load library &apos;libc.so.0&apos;</span><br></pre></td></tr></table></figure></p><p>解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo mv libuClibc-1.0.26.so /lib/            </span><br><span class="line">sudo chown -R root:root /lib/libuClibc-1.0.26.so</span><br><span class="line">sudo ln -s /lib/libuClibc-1.0.26.so /lib/libc.so.0</span><br></pre></td></tr></table></figure></p><p>但是但是 运行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/qemu-mipsel netcat_mipsel_little --help</span><br><span class="line">GNU netcat 0.7.1, a rewrite of the famous networking tool.</span><br><span class="line">Basic usages:</span><br><span class="line">connect to somewhere:  netcat_mipsel_little [options] hostname port [port] ...</span><br><span class="line">listen for inbound:    netcat_mipsel_little -l -p port [options] [hostname] [port] ...</span><br><span class="line">tunnel to somewhere:   netcat_mipsel_little -L hostname:port -p port [options]</span><br><span class="line"></span><br><span class="line">Mandatory arguments to long options are mandatory for short options too.</span><br><span class="line">Options:</span><br><span class="line">  -c, --close                close connection on EOF from stdin</span><br><span class="line">  -e, --exec=PROGRAM         program to exec after connect</span><br><span class="line">  -g, --gateway=LIST         source-routing hop point[s], up to 8</span><br><span class="line">  -G, --pointer=NUM          source-routing pointer: 4, 8, 12, ...</span><br><span class="line">  -h, --help                 display this help and exit</span><br><span class="line">  -i, --interval=SECS        delay interval for lines sent, ports scanned</span><br><span class="line">  -l, --listen               listen mode, for inbound connects</span><br><span class="line">  -L, --tunnel=ADDRESS:PORT  forward local port to remote address</span><br><span class="line">.....</span><br><span class="line">  </span><br><span class="line">sudo /usr/bin/qemu-mipsel netcat_mipsel_little -lvvp 555</span><br><span class="line">or</span><br><span class="line">sudo /usr/bin/qemu-mipsel netcat_mipsel_little 192.168.19.113 5555 &lt; /home/db/Desktop/netcat_mipsel_little</span><br><span class="line">    ==&gt; </span><br><span class="line">        Unsupported setsockopt level=65535 optname=128</span><br><span class="line">        Error: Couldn&apos;t create connection (err=-2): Protocol not available</span><br></pre></td></tr></table></figure></p><p><code>????????</code>  –help 没问题，其他参数就不行?</p><p><code>然后大神告诉我，可能路由器的Linux内核太低了,处理器mipsel也不支持buildroot编译内核3.2的,我看了一下是2.6.32的，而我编译的buildroot选择Linux内核是3.2，最高可选4.4。妈的 buildroot可选内核都没2.6.32，这让我怎么搞 !</code></p><p><code>Fri 24 Nov 2017 07:19:57 AM EST</code></p><p>周末玩荒野行动PC版两局都是第二，差点吃鸡….气死我了 </p><p>周一再搞 ， 发现<br>….<br><a href="https://buildroot.org/downloads/buildroot-2009.02.tar.gz" target="_blank" rel="noopener">https://buildroot.org/downloads/buildroot-2009.02.tar.gz</a><br>最低 -&gt; Linux 2.6.35.x kernel header -&gt; 无法编译</p><p>但是 ！！！！<br>这个版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://buildroot.org/downloads/buildroot-2012.05.tar.gz</span><br></pre></td></tr></table></figure></p><p>最低 -&gt; <code>Linux 2.6.35.x kernel header</code> -&gt; <code>编译成功</code><br>编译之后上传路由器 成功监听端口了,其它参数皆可正常使用，不会出现 <code>segmentation fault</code>.<br><a href="http://s.dropcanvas.com/1000000/923000/922746/netcat_2011_05" target="_blank" rel="noopener">http://s.dropcanvas.com/1000000/923000/922746/netcat_2011_05</a></p><p>Nice!!!! </p><p><strong>running netcat</strong><br>router_netcat.png<br>(AC66U and RT-N12 一樣的CPU)</p><p>这里还有个小点，放到Ubuntu的时候 使用qemu-mipsel执行netcat 依旧无法使用，猜测qemu版本问题，<br>我这个是2.5,官网已经2.11了，但是我apt-get install qemu时说此版本是最高了……估计从官网下载编译可以运行的。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># sudo /usr/bin/qemu-mipsel netcat_2011_05 -l -p 555</span><br><span class="line">Unsupported setsockopt level=65535 optname=128</span><br><span class="line">Error: Couldn&apos;t setup listening socket (err=-2)</span><br></pre></td></tr></table></figure></p><p>卸载重装qemu<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove --auto-remove qemu</span><br><span class="line">wget https://download.qemu.org/qemu-2.10.1.tar.xz</span><br><span class="line">tar xvJf qemu-2.10.1.tar.xz</span><br><span class="line">cd qemu-2.10.1</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"># cd qemu-2.10.1/mipsel-linux-user</span><br><span class="line"># mipsel-linux-user ./qemu-mipsel /home/db/Desktop/netcat_2011_05</span><br><span class="line">qemu: uncaught target signal 11 (Segmentation fault) - core dumped</span><br><span class="line">[1]    61221 segmentation fault (core dumped)  ./qemu-mipsel /home/db/Desktop/netcat_2011_05</span><br><span class="line">....还有错误  不管这个了</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Author : &lt;a href=&quot;https://sp4rr0w.github.io&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://sp4rr0w.github.io&lt;/a&gt;&lt;br&gt;Time : 2017-11-27 22:25:51&lt;br&gt;Router Model : RT-N12&lt;br&gt;Router CPU : MIPS32&lt;/p&gt;
&lt;h2 id=&quot;1-路由器架构&quot;&gt;&lt;a href=&quot;#1-路由器架构&quot; class=&quot;headerlink&quot; title=&quot;1. 路由器架构&quot;&gt;&lt;/a&gt;1. 路由器架构&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;admin@RT-N12:/tmp/home/root&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cat /proc/cpuinfo&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;system type             : Broadcom BCM53572 chip rev 1 pkg 8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;processor               : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;cpu model               : MIPS 74K V4.9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BogoMIPS                : 149.91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;wait instruction        : no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;microsecond timers      : yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;tlb_entries             : 32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;extra interrupt vector  : no&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hardware watchpoint     : yes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ASEs implemented        : mips16 dsp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;shadow register sets    : 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;VCED exceptions         : not available&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;VCEI exceptions         : not available&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;unaligned_instructions  : 51078121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dcache hits             : 2147483648&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;dcache misses           : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;icache hits             : 2147483648&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;icache misses           : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;instructions            : 2147483648&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;2-先编译buildroot&quot;&gt;&lt;a href=&quot;#2-先编译buildroot&quot; class=&quot;headerlink&quot; title=&quot;2. 先编译buildroot&quot;&gt;&lt;/a&gt;2. 先编译buildroot&lt;/h2&gt;&lt;p&gt;可知&lt;code&gt;路由器CPU&lt;/code&gt;为 &lt;code&gt;MIPS&lt;/code&gt;。由同事告知可以先编译&lt;code&gt;buildroot&lt;/code&gt;生成的gcc之后再指定编译&lt;code&gt;netcat&lt;/code&gt;，这样可以在路由器上运行。&lt;/p&gt;
&lt;p&gt;&lt;code&gt;折腾&lt;/code&gt;之路由此开始&lt;/p&gt;
&lt;p&gt;下载buildroot&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://buildroot.org/downloads/buildroot-2017.08.tar.gz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://buildroot.org/downloads/buildroot-2017.08.tar.gz&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="交叉编译" scheme="http://yoursite.com/tags/%E4%BA%A4%E5%8F%89%E7%BC%96%E8%AF%91/"/>
    
      <category term="netcat" scheme="http://yoursite.com/tags/netcat/"/>
    
      <category term="路由器" scheme="http://yoursite.com/tags/%E8%B7%AF%E7%94%B1%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>重新出发</title>
    <link href="http://yoursite.com/2017/11/26/%E9%87%8D%E6%96%B0%E5%87%BA%E5%8F%91/"/>
    <id>http://yoursite.com/2017/11/26/重新出发/</id>
    <published>2017-11-26T05:00:00.000Z</published>
    <updated>2018-03-20T09:23:00.298Z</updated>
    
    <content type="html"><![CDATA[<p><strong>好久不写博客了，CSDN都1年半没更新啦。</strong></p><blockquote><p><strong>BLOG</strong> </p><ul><li><strong>Github  : <a href="https://github.com/sp4rr0w" target="_blank" rel="noopener">https://github.com/sp4rr0w</a></strong></li><li><strong>CSDN    : <a href="http://blog.csdn.net/clownstar" target="_blank" rel="noopener">http://blog.csdn.net/clownstar</a></strong></li></ul></blockquote><p><strong>博客重启,就在此刻</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;好久不写博客了，CSDN都1年半没更新啦。&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;BLOG&lt;/strong&gt; &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Github  : &lt;a href=&quot;https://github.
      
    
    </summary>
    
    
  </entry>
  
</feed>
